generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum LeadStatus {
  New
  Contacted
  QuoteSent
  Interested
  ClosedWon
  ClosedLost
}

model Lead {
  id              String          @id @default(uuid())
  name            String
  email           String
  phone           String?
  eventId         String
  travellersCount Int
  status          LeadStatus      @default(New)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  event           Event           @relation(fields: [eventId], references: [id], onDelete: Cascade)
  statusHistory   LeadStatusHistory[]
  quotes          Quote[]

  @@index([status])
  @@index([eventId])
  @@index([createdAt])
}

model LeadStatusHistory {
  id         String     @id @default(uuid())
  leadId     String
  oldStatus  LeadStatus?
  newStatus  LeadStatus
  changedAt  DateTime   @default(now())

  lead       Lead       @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId])
  @@index([changedAt])
}

model Event {
  id        String    @id @default(uuid())
  name      String
  startDate DateTime
  endDate   DateTime
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt

  packages  Package[]
  leads     Lead[]

  @@index([startDate])
}

model Package {
  id        String   @id @default(uuid())
  eventId   String
  title     String
  basePrice Decimal  @db.Decimal(10, 2)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)
  quotes    Quote[]

  @@index([eventId])
}

model Quote {
  id                    String   @id @default(uuid())
  leadId                String
  packageId             String
  basePrice             Decimal  @db.Decimal(10, 2)
  seasonalAdjustment    Decimal  @db.Decimal(10, 2) @default(0)
  earlyBirdAdjustment   Decimal  @db.Decimal(10, 2) @default(0)
  lastMinuteAdjustment  Decimal  @db.Decimal(10, 2) @default(0)
  groupDiscount         Decimal  @db.Decimal(10, 2) @default(0)
  weekendSurcharge      Decimal  @db.Decimal(10, 2) @default(0)
  finalPrice            Decimal  @db.Decimal(10, 2)
  createdAt             DateTime @default(now())

  lead                  Lead     @relation(fields: [leadId], references: [id], onDelete: Cascade)
  package               Package  @relation(fields: [packageId], references: [id], onDelete: Cascade)

  @@index([leadId])
  @@index([packageId])
  @@index([createdAt])
}

